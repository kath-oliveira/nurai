{% extends 'base.html' %}

{% block title %}Valuation - {{ company.name }} - CFO as a Service{% endblock %}

{% block head_extra %}
<!-- Chart.js for graphs (Optional, if data becomes available) -->
{# <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> #}
<style>
    .valuation-method-card {
        margin-bottom: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<h1 class="mt-4">Valuation - {{ company.name }}</h1>

{# Use valuation_data passed from the updated app.py route #}
{% if valuation_data and valuation_data.range_min != 'Não calculado' %}
    <div class="alert alert-info mt-3">
        <strong>Status do Valuation:</strong> {{ valuation_data.status }}
    </div>

    <div class="card mt-4">
        <div class="card-header">Estimativa de Valor</div>
        <div class="card-body text-center">
            <h2 class="display-5">{{ valuation_data.range_min }} - {{ valuation_data.range_max }}</h2>
            <p class="text-muted">Baseado em: {{ valuation_data.methods_used | join(', ') }}</p>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">Premissas Utilizadas</div>
        <div class="card-body">
            <p>{{ valuation_data.assumptions }}</p>
        </div>
    </div>

    {# Placeholder for more detailed methods/charts if implemented later #}
    {#
    <h2 class="mt-4">Detalhes por Método (Exemplo)</h2>
    <div class="row">
        <div class="col-md-6">
            <div class="card valuation-method-card">
                <div class="card-header">Fluxo de Caixa Descontado (Simulado)</div>
                <div class="card-body">
                    <p>Valor Estimado: R$ 6.500.000</p>
                    <canvas id="dcfSensitivityChart" height="150"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card valuation-method-card">
                <div class="card-header">Múltiplos de Mercado (Simulado)</div>
                <div class="card-body">
                    <p>Valor Estimado: R$ 7.000.000</p>
                    <canvas id="multiplesChart" height="150"></canvas>
                </div>
            </div>
        </div>
    </div>
    #}

    <div class="card mt-2">
        <div class="card-header">Análise de Sensibilidade</div>
        <div class="card-body">
            <p>{{ valuation_data.sensitivity_analysis }}</p>
        </div>
    </div>

{% elif valuation_data %}
    {# Case where valuation_data exists but calculation failed (e.g., no faturamento) #}
     <div class="alert alert-warning mt-4">
        <strong>Status do Valuation:</strong> {{ valuation_data.status }}<br>
        {{ valuation_data.assumptions }}
    </div>
{% else %}
    <div class="alert alert-warning mt-4">
        O cálculo de valuation ainda não pôde ser gerado. Certifique-se de que o questionário foi preenchido com dados válidos (como Faturamento Anual).
    </div>
{% endif %}

<div class="mt-4">
    <a href="{{ url_for('company_detail', company_id=company.id) }}" class="btn btn-secondary"><i class="fas fa-arrow-left me-2"></i>Voltar para Detalhes da Empresa</a>
</div>

{% endblock %}

{% block scripts_extra %}
{# Chart.js script removed as the basic calculation doesn't provide data for charts yet #}
{# If adding charts later, ensure valuation_data provides necessary values #}
{% endblock %}

