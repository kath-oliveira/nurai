{% extends 'base.html' %}

{% block title %}Diagnóstico Financeiro - {{ company.name }} - CFO as a Service{% endblock %}

{% block head_extra %}
<!-- Chart.js for graphs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .indicator-card {
        border-left: 5px solid #0d6efd; /* Blue */
        margin-bottom: 1rem;
    }
    .indicator-card.attention {
        border-left-color: #ffc107; /* Yellow */
    }
    .indicator-card.critical {
        border-left-color: #dc3545; /* Red */
    }
</style>
{% endblock %}

{% block content %}
<h1 class="mt-4">Diagnóstico Financeiro - {{ company.name }}</h1>

{# Use diagnostic_data which is now passed from the updated app.py route #}
{% if diagnostic_data %}
    <div class="alert alert-info mt-3">
        <strong>Status do Diagnóstico:</strong> {{ diagnostic_data.status }}
    </div>

    <div class="card mt-4">
        <div class="card-header">Resumo da Análise</div>
        <div class="card-body">
            <p>{{ diagnostic_data.summary }}</p>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">Recomendações</div>
        <div class="card-body">
            <ul>
                {% for recommendation in diagnostic_data.recommendations %}
                <li>{{ recommendation }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <h2 class="mt-4">Indicadores Chave</h2>
    <div class="row">
        {% for key, value in diagnostic_data.indicators.items() %}
        <div class="col-md-6 col-lg-3">
            {# Add attention/critical classes based on content if needed #}
            <div class="card indicator-card {% if 'Atenção' in value|string %}attention{% elif 'Crítico' in value|string %}critical{% elif 'alto' in value|string %}attention{% elif 'baixa' in value|string %}attention{% endif %}">
                <div class="card-body">
                    <h5 class="card-title text-capitalize">{{ key.replace('_', ' ') }}</h5>
                    <p class="card-text">{{ value }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Placeholder for Charts (can be re-enabled if data is suitable) -->
    {#
    <h2 class="mt-4">Visualizações Gráficas (Exemplo)</h2>
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Distribuição de Despesas</div>
                <div class="card-body">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Evolução da Receita</div>
                <div class="card-body">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    #}

{% else %}
    <div class="alert alert-warning mt-4">
        O diagnóstico financeiro ainda não pôde ser gerado. Certifique-se de que o questionário foi preenchido com dados válidos (como Faturamento Anual e Lucro Líquido).
    </div>
{% endif %}

<div class="mt-4">
    <a href="{{ url_for('company_detail', company_id=company.id) }}" class="btn btn-secondary"><i class="fas fa-arrow-left me-2"></i>Voltar para Detalhes da Empresa</a>
</div>

{% endblock %}

{% block scripts_extra %}
{# Chart.js script removed as the basic calculation doesn't provide data for charts yet #}
{# If adding charts later, ensure diagnostic_data provides necessary values #}
{% endblock %}

