{% extends 'base.html' %}

{% block title %}Upload de Documentos - {{ company.name }} - CFO as a Service{% endblock %}

{% block head_extra %}
<style>
    .drop-zone {
        border: 2px dashed #ccc;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }
    .drop-zone.dragover {
        background-color: #e9ecef;
    }
    .file-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid #eee;
    }
    .file-list-item:last-child {
        border-bottom: none;
    }
</style>
{% endblock %}

{% block content %}
<h1 class="mt-4">Upload de Documentos - {{ company.name }}</h1>
<p>Envie os documentos financeiros da sua empresa para análise.</p>

<form method="POST" action="{{ url_for('upload_document', company_id=company.id) }}" enctype="multipart/form-data" id="uploadForm">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>

    <div class="card mt-4">
        <div class="card-body">
            <div class="mb-3">
                <label for="document_type" class="form-label">Tipo de Documento <span class="text-danger">*</span></label>
                <select class="form-select" id="document_type" name="document_type" required>
                    <option value="">Selecione o tipo...</option>
                    <option value="extrato_bancario">Extrato Bancário</option>
                    <option value="dre">DRE (Demonstração de Resultado)</option>
                    <option value="balanco_patrimonial">Balanço Patrimonial</option>
                    <option value="nota_fiscal">Nota Fiscal</option>
                    <option value="outro">Outro</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="fileUpload" class="form-label">Selecione o Arquivo (PDF, JPG, PNG, XLSX)</label>
                <input class="form-control" type="file" id="fileUpload" name="file" required>
            </div>

            <!-- Drop Zone (Optional Enhancement) -->
            <div id="dropZone" class="drop-zone mb-3 d-none">
                Arraste e solte o arquivo aqui ou clique para selecionar
            </div>

            <button type="submit" class="btn btn-success"><i class="fas fa-upload me-2"></i>Enviar Documento</button>
            <a href="{{ url_for('company_detail', company_id=company.id) }}" class="btn btn-secondary">Cancelar</a>
        </div>
    </div>
</form>

<hr class="my-4">

<h2>Documentos Enviados</h2>
{% if documents %}
    <ul class="list-group">
        {% for doc in documents %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <i class="fas fa-file-alt me-2"></i>
                <a href="{{ url_for('serve_upload', filename=doc.stored_filename) }}" target="_blank">{{ doc.original_filename }}</a>
                <small class="text-muted ms-2">({{ doc.document_type }}) - Enviado em: {{ doc.uploaded_at.strftime('%d/%m/%Y %H:%M') }}</small>
            </div>
            <span class="badge bg-{{ 'success' if doc.status == 'processed' else ('warning' if doc.status == 'pending' else 'danger') }} rounded-pill">{{ doc.status }}</span>
            <!-- Add delete button if needed -->
            <!-- 
            <form method="POST" action="{{ url_for('delete_document', document_id=doc.id) }}" style="display: inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
                <button type="submit" class="btn btn-sm btn-danger ms-2" onclick="return confirm('Tem certeza que deseja excluir este documento?');"><i class="fas fa-trash"></i></button>
            </form>
            -->
        </li>
        {% endfor %}
    </ul>
{% else %}
    <p>Nenhum documento enviado para esta empresa ainda.</p>
{% endif %}

{% endblock %}

{% block scripts_extra %}
<script>
// Basic Drop Zone Logic (Optional Enhancement)
/*
document.addEventListener('DOMContentLoaded', function() {
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileUpload');

    if (dropZone && fileInput) {
        dropZone.classList.remove('d-none'); // Show drop zone if JS is enabled

        dropZone.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                dropZone.textContent = fileInput.files[0].name;
            }
        });

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                dropZone.textContent = fileInput.files[0].name;
                // Trigger change event if needed by other scripts
                const event = new Event('change');
                fileInput.dispatchEvent(event);
            }
        });
    }
});
*/
</script>
{% endblock %}

